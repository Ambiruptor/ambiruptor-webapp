<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Ambiruptor - ambiguation interruptor</title>

        <!-- Bootstrap core CSS -->
        <link href="../static/bootstrap-3.3.6-dist/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom styles -->
        <link rel="stylesheet" href="static/css/style.css">

        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>

    <body class="animated bounceInDown">
        <div class="container">
            <div class="page-header">
                <div id="title"> Ambiguity Interruptor </div>
            </div>

           <!--   -->
           <div class="content">
                <div class="row">
                    <div class="col-md-5">
                        <div class="centerBlock">
                            <h2 id="tit1" class="spaced">
                                AMBIRUPTEE
                            </h2>
                            <textarea class="form-control" style="min-width: 100%" id="ambiguous_text" placeholder="Enter your text here" class="spaced"></textarea>
                            <div class="btn-group" id="left-btn-group">
                                <button type="button" class="btn btn-default" id="eraseButton" onclick="erase()">   Erase
                                    <!-- Also possible -->
                                    <!-- <span class="glyphicon glyphicon-remove"></span> -->
                                </button>
                            </div>
                            <div class="btn-group" id="right-btn-group">
                                <button id="disamButton" onclick="disambiguate()" type="button" class="btn btn-default">Disambiguate</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="centerBlock">
                            <img class="img-responsive" style="min-width: 100%" src="static/img/logo.png" alt="Logo">
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="centerBlock">
                            <div id="disambiguated">
                                <h2 id="tit2" class="spaced"> AMBIRUPTED </h2>
                                <div id="disambiguated_text"> </div>
                            </div>
                            <div class="btn-group" id="right-btn-group-dis">
                                <button type="button" class='btn btn-default' id="checkButton" onclick="checked()"> Eveything is OK! </button>
                            </div>
                            <div class="btn-group" id="left-btn-group-dis">
                                <button type="button" class='btn btn-default' id="checkmodeButton" onclick="checkmode()"> Enter checkmode </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="warnings"></div>
        </div>

        <footer class="footer">
            <div class="container">

                <ul class="social-icons">
                        <p class="text-muted"><a class="github" href="https://github.com/Ambiruptor/Ambiruptor" title="Github">Github</a> Bla bla footer here: Powered by the best integrated project team, 2016</p>
                </ul>

            </div>
        </footer>

        <!-- Scripts -->
        <script src="http://code.jquery.com/jquery-2.2.0.min.js"></script>
        <script>
            //we define global variables
            var obj="";
            var str="";

            function success(result) {
                document.getElementById("warnings").innerHTLM="";
                //to be changed ; see with Simon (Pierre)
                result2= "{\"disamb\" : " + result + "}";
                obj = JSON.parse(result2);
                str = $("#ambiguous_text").val();
                var nhtml = "";
                var prec=0;
                for(i=0; i<obj.disamb.length; i++){
                    nhtml += str.substring(prec,obj.disamb[i].begin);
                    nhtml += "<a href=\"" + obj.disamb[i].url + "\" target=\"_blank\">";
                    nhtml += str.substring(obj.disamb[i].begin, obj.disamb[i].end);
                    nhtml += "</a>";
                    prec = obj.disamb[i].end;
                }
                nhtml += str.slice(prec);
                document.getElementById("disambiguated_text").innerHTML = nhtml;
                document.getElementById("checkButton").style.display="block";
                document.getElementById("checkmodeButton").style.display="block";
            }
            function disambiguate() {
                var str = $("#ambiguous_text").val();
                var request = $.post("/disambiguate.json", {"text" : str});
                request.success(success);
                request.fail(function(){document.getElementById("warnings").innerHTML="Error"});
            }
            function erase(){
                document.getElementById("ambiguous_text").value="";
                document.getElementById("disambiguated_text").innerHTML="";
            }

            function checkmode(){
                //Receive from server the list of different possible sense for each ambiguous word
                document.getElementById("checkButton").innerHTML = "Now everything is OK!"
                document.getElementById("checkmodeButton").style="display:none;"
                var possible_senses = [
                    ['Bar (place)','Bar (fish)'],
                    ['Plant', 'Factory']
                ];
                var nhtml="";
                var prec=0;
                for(i=0; i<obj.disamb.length; i++){
                    nhtml += str.substring(prec, obj.disamb[i].begin, obj.disamb[i].end);
                    nhtml += "<select id=\"selection" + i + "\">";
                    for(j=0; j<possible_senses[i].length; j++){
                        nhtml += "<option>" + possible_senses[i][j] + "</option>";
                    }
                    nhtml += "</select>";
                    prec= obj.disamb[i].end;
                }
                nhtml += str.slice(prec);
                document.getElementById("disambiguated_text").innerHTML = nhtml;
            }
            function checked(){
                alert("Thank you for your support!")
                // Send to server
                if(document.getElementById("checkButton").innerHTML=="Everything is OK!"){
                    //Send the fact that the given senses were right
                    alert("TODO : send this information to server");
                }
                else{
                    //Send the corrections
                    var corrections = [];
                    for(i=0; i<obj.disamb.length; i++){
                        corrections.push(document.getElementById("selection"+i).selectedIndex);
                    }
                    alert("TODO : send "+corrections + " to server");

                }
            }


        </script>
    </body>
</html>

<style>

</style>
